<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      >
    <h:head>
        <title>Reserva</title>


    </h:head>
    <h:body>
        
        <ui:composition template="../templates/template.xhtml"> 

            <ui:define name="content">

                <f:event type="preRenderView" listener="#{reserva.cargarMaterias(usuario.unidadAcademica)}"></f:event>

                <p:layoutUnit position="center" resizable="false" id="contenidoPrincipal"
                              styleClass="pLayoutContenidoPrincipal" >
                    <!--                    <p:tabView id="tabv">
                                            <p:tab id="tab-reserva" title="Reservacion">-->
                    <h:form id="form1">

                        <p:growl id="grid-r" autoUpdate="true"  />
                        <h:panelGrid  id="panel" columns="2" cellpadding="10">

                            <p:outputLabel id="label-docente" value="Docente: *" />
                            <p:selectOneMenu id="lista-docente"  required="true" requiredMessage="Docente requerido" style="width:300px;"
                                             autoWidth="false" value="#{reserva.idPersona}">

                                <f:selectItems value="#{reserva.listaD}" var="d" itemValue="#{d.id}"  itemLabel="#{d.valor}"  />
                            </p:selectOneMenu>

                            <p:outputLabel  value="Materia: *" />
                            <p:selectOneMenu  required="false" requiredMessage="Materia requerido" style="width:300px;"
                                              autoWidth="false" value="#{reserva.idMateria}">
                                <f:selectItems value="#{reserva.listaM}" var="m" itemValue="#{m.id}" itemLabel="#{m.valor}" ></f:selectItems>

                            </p:selectOneMenu>

                            <p:outputLabel  value="Laboratorio: *" />
                            <p:selectOneMenu id="labs"  required="true" requiredMessage="Laboratorio requerido" style="width:300px;"
                                             autoWidth="false" value="#{reserva.idLaboratorio}">
                                <p:ajax listener="#{reserva.cargarServicios(reserva.idLaboratorio)}" update="detalleServicios"  />                                <f:selectItem itemLabel="Seleccione un laboratorio" itemValue="" ></f:selectItem>
                                <f:selectItems value="#{reserva.listaL}" var="l" itemValue="#{l.id}"  itemLabel="#{l.valor}"  />
                            </p:selectOneMenu>
                            <!--                                    <p:selectBooleanCheckbox value="true">
                                                                    <p:ajax update="msg"  />
                                                                </p:selectBooleanCheckbox>-->
                            <p:commandButton  value="Calendario disponible" update="eventDetails" action="#{scheduleView.cargarDisponibilidadFechas(reserva.idLaboratorio)}"></p:commandButton>

                        </h:panelGrid>
                        <p:separator/>

                        <p:panel>
                            <p:outputLabel  value="Detalle laboratorio :" />
                            <br></br>
                            <br></br>
                            <p:outputLabel  value="Tipo de servicio :" />
                            <br></br>
                            <p:selectOneMenu id="tipo-servicio" value="#{reserva.tipoServicio}">
                                <p:ajax listener="#{reserva.cargarServicios(reserva.idLaboratorio)}" update="detalleServicios"  />
                                <f:selectItem itemLabel="Seleccione un tipo" itemValue="" />
                                <f:selectItem itemLabel="SOFTWARE" itemValue="SOFTWARE" />
                                <f:selectItem itemLabel="HARDWARE" itemValue="HARDWARE" />
                            </p:selectOneMenu>
                            <br></br>
                            <br></br>
                            <p:dataTable paginator="true" rows="5" id="detalleServicios" value="#{reserva.servicios}" var="r" style="width:570px;font-size: x-small;" >
                                <p:column headerText="Servicio" sortBy="#{r.nombre}" >
                                    <h:outputText id="serv" value="#{r.nombre}" />
                                </p:column>
                                <p:column headerText="Cantidad">
                                    <h:outputText value="#{r.cantidad}" />
                                </p:column>

                                <p:column headerText="Descripcion">
                                    <h:outputText value="#{r.descripcion}" />
                                </p:column>


                            </p:dataTable>
                        </p:panel>

                    </h:form>
                    <!-- </p:tab>
                    
                   </p:tabView>-->
                </p:layoutUnit>



                <p:dialog styleClass="title" widgetVar="disponibilidadDialog" header="CALENDARIO DISPONIBLE" showEffect="clip" hideEffect="clip" height="500" width="1200" responsive="true" draggable="false">
                    <h:panelGrid id="eventDetails" columns="2" cellspacing="35"  >

                        <p:schedule style="width: 680px;height: 500px;" draggable="false" styleClass="custom" id="schedule" value="#{scheduleView.eventModel}" widgetVar="myschedule" timeZone="GMT-5"   >
                            <p:ajax event="eventSelect" listener="#{scheduleView.onEventSelect}" update="bloques"  />
                        </p:schedule>

                        <p:dataTable id="bloques" value="#{scheduleView.bloques}" var="b" style="width: 400px;margin-left: 10%;">
                            <p:column headerText="Bloque disponible">
                                <h:outputText value="#{b.bloque}"  />
                            </p:column>

                            <p:column headerText="Seleccionar">
                                <h:form>
                                    <h:commandLink value="Reservar" action="#{reserva.reservar(b.id,usuario.nombreRol,usuario.id)}"  ></h:commandLink>
                                </h:form>

                            </p:column>


                        </p:dataTable>


                    </h:panelGrid>
                </p:dialog>  

                <script>
                    //permisos vistas
                    $(document).on("ready", function () {
                        switch ('#{usuario.nombreRol}') {

                            case 'DOCENTE':
                            {

                                $('#form1\\:label-docente').css("display", "none");
                                $('#form1\\:lista-docente').css("display", "none");
                                break;
                            }

                        }
                    });
                </script>

            </ui:define>
        </ui:composition>


    </h:body>
</html>
